#!/usr/bin/bash
# path : ~/.local/bin/ppngio-push

if [[ "$1" == "~"* ]]; then
  set -- "${1/#\~/$HOME}" "${@:1}"
fi

if [ -z "$2" ]; then
  set -- "$1" "steamuser" "${@:1}"
fi

FILE_PATH="$1"
PPNGIO_IDENTFIER="$2"
DEBUG="${3:-}"

if [ "$DEBUG" ]; then
  echo "$@"
  echo "$FILE_PATH $PPNGIO_IDENTFIER $DEBUG"
  exit
fi

TEMP="/tmp/ppngio.tmp"
LOCK="/tmp/ppngio.lock"

echo "$FILE_PATH" >"$LOCK"

curl -T "$LOCK" "ppng.io/$PPNGIO_IDENTFIER.lock" &>/dev/null &
curl -T "$FILE_PATH" "ppng.io/$PPNGIO_IDENTFIER.tmp" &>/dev/null &

wait

rm "/tmp/ppngio.lock"
